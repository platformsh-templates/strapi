function r(r,n,t){var u=r,e=n;if(-1!==n.indexOf(".")){var f=n.split(".");e=f.pop(),u=f.reduce((function(r,n){return r[n]=r[n]||{},r[n]}),r)}u[e]=t}function n(r){for(var n=arguments.length,t=new Array(n>1?n-1:0),u=1;u<n;u++)t[u-1]=arguments[u];for(var e=t[0],f=t[1],o=t[2],i={},c=r.rulesFor(e,f),a=0;a<c.length;a++){var v=c[a],y=v.inverted?"$and":"$or";if(!v.conditions){if(v.inverted)break;return delete i[y],i}i[y]=i[y]||[],i[y].push(o(v))}return i.$or?i:null}function t(n){for(var t=arguments.length,u=new Array(t>1?t-1:0),e=1;e<t;e++)u[e-1]=arguments[e];var f=u[0],o=u[1];return n.rulesFor(f,o).filter((function(r){return!r.inverted&&r.conditions})).reduce((function(n,t){var u=t.conditions;return Object.keys(u).reduce((function(n,t){var e=u[t];return e&&e.constructor===Object||r(n,t,e),n}),n)}),{})}var u=function(r){return r.fields};function e(r){delete this[r]}function f(r){this[r]=!0}function o(r,n,t,o){void 0===o&&(o={});var i=o.fieldsFrom||u,c=r.possibleRulesFor(n,t).filter((function(r){return r.matchesConditions(t)})).reverse().reduce((function(r,n){var t=i(n);if(t){var u=n.inverted?e:f;t.forEach(u,r)}return r}),{});return Object.keys(c)}var i=function(r){return Array.isArray(r)?r.join(","):r};function c(r,n){return r.map((function(r){for(var t,u=[i(r.action||r.actions),"function"==typeof n?(t=r.subject,Array.isArray(t)?t:[t]).map(n).join(","):i(r.subject),r.conditions||0,r.inverted?1:0,r.fields?i(r.fields):0,r.reason||""];!u[u.length-1];)u.pop();return u}))}function a(r,n){return r.map((function(r){var t=r[0],u=r[1],e=r[2],f=r[3],o=r[4],i=r[5],c=u.split(","),a={inverted:!!f,action:t.split(","),subject:"function"==typeof n?c.map(n):c};return e&&(a.conditions=e),o&&(a.fields=o.split(",")),i&&(a.reason=i),a}))}export{c as packRules,o as permittedFieldsOf,t as rulesToFields,n as rulesToQuery,a as unpackRules};
//# sourceMappingURL=extra.js.map
